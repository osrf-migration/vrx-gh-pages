{"changes": {"content": {"new": "**Purpose**\r\n\r\nIn order for the competition to be run smoothly, we need an elegant way to shutdown Gazebo/ROS after a trial is completed such that we can record the results and then start the next task.\r\n\r\n**What is currently happening**\r\n\r\nCurrently, while running the competition, the `/vrx/task/info` topic is published, which shows the current status and score. An example is shown below.\r\n\r\n```\r\nname: &#34;scan_dock&#34;\r\nstate: &#34;finished&#34;\r\nready_time: \r\n  secs: 3\r\n  nsecs:         0\r\nrunning_time: \r\n  secs: 6\r\n  nsecs:         0\r\nelapsed_time: \r\n  secs: 10\r\n  nsecs:         0\r\nremaining_time: \r\n  secs: 0\r\n  nsecs:         0\r\ntimed_out: True\r\nscore: 0.0\r\n```\r\n\r\nAfter it is timed\\_out, the simulation continues to run as normal. This is desired behavior for testing, as we may want to still try things out after the competition is over. However, we need the option to end it.\r\n\r\n**Possible Solution**\r\n\r\nAfter looking into ARIAC\u2019s method of ending competition, what they did was:\r\n\r\n1. Set environment variable `ARIAC_EXIT_ON_COMPLETION=1`, then ran their system. This is shown here: [https://github.com/osrf/ariac-docker/blob/master/ariac-server/ariac-server/run\\_ariac\\_task.sh](https://github.com/osrf/ariac-docker/blob/master/ariac-server/ariac-server/run_ariac_task.sh) line 40\r\n2. In their ROS task manager plugin \\([https://bitbucket.org/osrf/ariac/src/master/osrf\\_gear/src/ROSAriacTaskManagerPlugin.cc](https://bitbucket.org/osrf/ariac/src/master/osrf_gear/src/ROSAriacTaskManagerPlugin.cc)\\), they have a Gazebo publisher that publishes to `/gazebo/server/control`, to end the simulation. This is a good reference for what we want.\r\n\r\n**Open Design Decisions**\r\n\r\n* Should this just kill Gazebo or kill all ROS nodes and ROS? ARIAC only kills Gazebo I believe, but I\u2019m not sure if there\u2019s any reason not to kill all.\r\n* Should we use an environment variable, ros parameter, roslaunch parameter?\r\n* Should we implement this in the scoring plugin or somewhere else?\r\n* Should we also add some important competition end functionality in the same place?\r\n\r\n    * Eg. event-driven check for end condition \\(the current publish rate to `/vrx/task/info` is 1Hz, which may be too low to just subscribe to for scoring\\)\r\n    \r\n\r\n```\r\nrostopic hz  /vrx/task/info \r\nsubscribed to [/vrx/task/info]\r\nWARNING: may be using simulated time\r\naverage rate: 0.999\r\n    min: 1.001s max: 1.001s std dev: 0.00000s window: 2\r\naverage rate: 1.000\r\n    min: 0.999s max: 1.001s std dev: 0.00100s window: 3\r\n```\r\n\r\n* Should we output final score to the screen? Put it in the Gazebo or ROS log file \\(probably ROS\\)?", "old": "**Purpose**\r\n\r\nIn order for the competition to be run smoothly, we need an elegant way to shutdown Gazebo/ROS after a trial is completed such that we can record the results and then start the next task. \r\n\r\n**What is currently happening**\r\n\r\nCurrently, while running the competition, the `/vrx/task/info` topic is published, which shows the current status and score. An example is shown below. \r\n\r\n```\r\nname: \"scan_dock\"\r\nstate: \"finished\"\r\nready_time: \r\n  secs: 3\r\n  nsecs:         0\r\nrunning_time: \r\n  secs: 6\r\n  nsecs:         0\r\nelapsed_time: \r\n  secs: 10\r\n  nsecs:         0\r\nremaining_time: \r\n  secs: 0\r\n  nsecs:         0\r\ntimed_out: True\r\nscore: 0.0\r\n```\r\n\r\nAfter it is timed\\_out, the simulation continues to run as normal. This is desired behavior for testing, as we may want to still try things out after the competition is over. However, we need the option to end it.\r\n\r\n**What we need**\r\n\r\n**Possible Solution**\r\n\r\nAfter looking into ARIAC\u2019s method of ending competition, what they did was:\r\n\r\n1. Set environment variable `ARIAC_EXIT_ON_COMPLETION=1`, then ran their system. This is shown here: [https://github.com/osrf/ariac-docker/blob/master/ariac-server/ariac-server/run\\_ariac\\_task.sh](https://github.com/osrf/ariac-docker/blob/master/ariac-server/ariac-server/run_ariac_task.sh) line 40\r\n2. In their ROS task manager plugin \\([https://bitbucket.org/osrf/ariac/src/master/osrf\\_gear/src/ROSAriacTaskManagerPlugin.cc](https://bitbucket.org/osrf/ariac/src/master/osrf_gear/src/ROSAriacTaskManagerPlugin.cc)\\), they have a Gazebo publisher that publishes to `/gazebo/server/control`, to end the simulation. This is a good reference for what we want.\r\n\r\n**Open Design Decisions**\r\n\r\n* Should this just kill Gazebo or kill all ROS nodes and ROS? ARIAC only kills Gazebo I believe, but I\u2019m not sure if there\u2019s any reason not to kill all.\r\n* Should we use an environment variable, ros parameter, roslaunch parameter?\r\n* Should we implement this in the scoring plugin or somewhere else?\r\n* Should we also add some important competition end functionality in the same place?\r\n\r\n    * Eg. event-driven check for end condition \\(the current publish rate to `/vrx/task/info` is 1Hz, which may be too low to just subscribe to for scoring\\)\r\n    \r\n\r\n```\r\nrostopic hz  /vrx/task/info \r\nsubscribed to [/vrx/task/info]\r\nWARNING: may be using simulated time\r\naverage rate: 0.999\r\n\tmin: 1.001s max: 1.001s std dev: 0.00000s window: 2\r\naverage rate: 1.000\r\n\tmin: 0.999s max: 1.001s std dev: 0.00100s window: 3\r\n```\r\n\r\n* Should we output final score to the screen? Put it in the Gazebo or ROS log file \\(probably ROS\\)?"}}, "links": {"self": {"href": "data/repositories/osrf/vrx/issues/139/changes/52965772.json"}, "html": {"href": "#!/osrf/vrx/issues/139#comment-52965772"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/vrx/issues/139.json"}}, "type": "issue", "id": 139, "repository": {"links": {"self": {"href": "data/repositories/osrf/vrx.json"}, "html": {"href": "#!/osrf/vrx"}, "avatar": {"href": "data/bytebucket.org/ravatar/{e278ca38-7edb-4e62-b785-46dff5617d98}ts=2274605"}}, "type": "repository", "name": "vrx", "full_name": "osrf/vrx", "uuid": "{e278ca38-7edb-4e62-b785-46dff5617d98}"}, "title": "Set environment variable or parameter to shutdown Gazebo/ROS on task completion"}, "created_on": "2019-07-12T20:58:04.032623+00:00", "user": {"display_name": "Tyler Lum", "uuid": "{305d9368-23ba-4f72-b1d4-7d17d2a062d8}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B305d9368-23ba-4f72-b1d4-7d17d2a062d8%7D"}, "html": {"href": "https://bitbucket.org/%7B305d9368-23ba-4f72-b1d4-7d17d2a062d8%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/5b96b66385af94340e7cabce/b8bb780f-62b7-47f8-9d03-ee65c7d17ad4/128"}}, "nickname": "tylerlum", "type": "user", "account_id": "5b96b66385af94340e7cabce"}, "message": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "type": "issue_change", "id": 52965772}