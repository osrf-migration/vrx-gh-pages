{"links": {"self": {"href": "data/repositories/osrf/vrx/issues/72/comments/50854171.json"}, "html": {"href": "#!/osrf/vrx/issues/72#comment-50854171"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/vrx/issues/72.json"}}, "type": "issue", "id": 72, "repository": {"links": {"self": {"href": "data/repositories/osrf/vrx.json"}, "html": {"href": "#!/osrf/vrx"}, "avatar": {"href": "data/bytebucket.org/ravatar/{e278ca38-7edb-4e62-b785-46dff5617d98}ts=2274605"}}, "type": "repository", "name": "vrx", "full_name": "osrf/vrx", "uuid": "{e278ca38-7edb-4e62-b785-46dff5617d98}"}, "title": "Build errors for nvidia Dockerfile"}, "content": {"raw": "@caguero and @brian_bingham \n\nI think I have a fix for the problem Carlos found, and it is now implemented in the dockerfile-update branch. Unfortunately, I really don't understand why it works, so that makes me a little uneasy. Maybe you guys have some ideas. Seemingly overnight, our apt install line started producing dependency errors when run with the nvidia base image. Here's the line:\n\n```\n#!bash\n\nRUN apt update \\\n && apt install -y \\\n    ${GAZ} \\\n    lib${GAZ}-dev \\\n    ros-${DIST}-ros-base \\\n    ros-${DIST}-xacro \\\n    ros-${DIST}-gazebo-ros \\\n    ros-${DIST}-gazebo-plugins \\\n    ros-${DIST}-hector-gazebo-plugins \\\n    ros-${DIST}-joy \\\n#   ros-${DIST}-joy-teleop \\\n    ros-${DIST}-key-teleop \\\n#   ros-${DIST}-teleop-tools \\\n#   ros-${DIST}-teleop-twist-keyboard \\\n#   ros-${DIST}-robot-localization \\\n    ros-${DIST}-velodyne-simulator\n```\n\n\nThe problem is that if I uncomment any of the commented lines, apt returns the error:\n\n```\n#!bash\n\nlibgazebo9-dev : Depends: qtbase5-dev but it is not going to be installed\n```\n\nThe underlying problem appears to be the libgles2-mesa-dev package, which is required by qtbase5-dev. It seems that adding in the commented packages above causes apt to decide not to install this dependency.\n\nThis is only the case when using the Nvidia base image (it works fine in an Ubuntu 18 VM, and works fine with the ubuntu18 base image). Moreover, if I log in to the last layer that built successfully and manually run:\n\n\n```\n#!bash\n\napt install qtbase5-dev\n```\n\neverything works fine. Yet, if I add qtbase5-dev explicitly to my list of packages to install, it fails with the message \"Depends: libgles2-mesa-dev but it is not going to be installed\"\n\nIf I add both qtbase5-dev and libgles2-mesa-dev to the list, everything works.\n\nSo in summary, it works now, but I'm lost. Does anyone have a decent explanation for this behavior?", "markup": "markdown", "html": "<p>@caguero and @brian_bingham </p>\n<p>I think I have a fix for the problem Carlos found, and it is now implemented in the dockerfile-update branch. Unfortunately, I really don't understand why it works, so that makes me a little uneasy. Maybe you guys have some ideas. Seemingly overnight, our apt install line started producing dependency errors when run with the nvidia base image. Here's the line:</p>\n<div class=\"codehilite language-bash\"><pre><span></span>RUN apt update <span class=\"se\">\\</span>\n <span class=\"o\">&amp;&amp;</span> apt install -y <span class=\"se\">\\</span>\n    <span class=\"si\">${</span><span class=\"nv\">GAZ</span><span class=\"si\">}</span> <span class=\"se\">\\</span>\n    lib<span class=\"si\">${</span><span class=\"nv\">GAZ</span><span class=\"si\">}</span>-dev <span class=\"se\">\\</span>\n    ros-<span class=\"si\">${</span><span class=\"nv\">DIST</span><span class=\"si\">}</span>-ros-base <span class=\"se\">\\</span>\n    ros-<span class=\"si\">${</span><span class=\"nv\">DIST</span><span class=\"si\">}</span>-xacro <span class=\"se\">\\</span>\n    ros-<span class=\"si\">${</span><span class=\"nv\">DIST</span><span class=\"si\">}</span>-gazebo-ros <span class=\"se\">\\</span>\n    ros-<span class=\"si\">${</span><span class=\"nv\">DIST</span><span class=\"si\">}</span>-gazebo-plugins <span class=\"se\">\\</span>\n    ros-<span class=\"si\">${</span><span class=\"nv\">DIST</span><span class=\"si\">}</span>-hector-gazebo-plugins <span class=\"se\">\\</span>\n    ros-<span class=\"si\">${</span><span class=\"nv\">DIST</span><span class=\"si\">}</span>-joy <span class=\"se\">\\</span>\n<span class=\"c1\">#   ros-${DIST}-joy-teleop \\</span>\n    ros-<span class=\"si\">${</span><span class=\"nv\">DIST</span><span class=\"si\">}</span>-key-teleop <span class=\"se\">\\</span>\n<span class=\"c1\">#   ros-${DIST}-teleop-tools \\</span>\n<span class=\"c1\">#   ros-${DIST}-teleop-twist-keyboard \\</span>\n<span class=\"c1\">#   ros-${DIST}-robot-localization \\</span>\n    ros-<span class=\"si\">${</span><span class=\"nv\">DIST</span><span class=\"si\">}</span>-velodyne-simulator\n</pre></div>\n\n\n<p>The problem is that if I uncomment any of the commented lines, apt returns the error:</p>\n<div class=\"codehilite language-bash\"><pre><span></span>libgazebo9-dev : Depends: qtbase5-dev but it is not going to be installed\n</pre></div>\n\n\n<p>The underlying problem appears to be the libgles2-mesa-dev package, which is required by qtbase5-dev. It seems that adding in the commented packages above causes apt to decide not to install this dependency.</p>\n<p>This is only the case when using the Nvidia base image (it works fine in an Ubuntu 18 VM, and works fine with the ubuntu18 base image). Moreover, if I log in to the last layer that built successfully and manually run:</p>\n<div class=\"codehilite language-bash\"><pre><span></span>apt install qtbase5-dev\n</pre></div>\n\n\n<p>everything works fine. Yet, if I add qtbase5-dev explicitly to my list of packages to install, it fails with the message \"Depends: libgles2-mesa-dev but it is not going to be installed\"</p>\n<p>If I add both qtbase5-dev and libgles2-mesa-dev to the list, everything works.</p>\n<p>So in summary, it works now, but I'm lost. Does anyone have a decent explanation for this behavior?</p>", "type": "rendered"}, "created_on": "2019-03-01T22:19:00.132152+00:00", "user": {"display_name": "Michael McCarrin", "uuid": "{3c3f500d-bbf6-472c-b8f7-627e5eabc226}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3c3f500d-bbf6-472c-b8f7-627e5eabc226%7D"}, "html": {"href": "https://bitbucket.org/%7B3c3f500d-bbf6-472c-b8f7-627e5eabc226%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/a50abc93a3175f92c79e7521dfe089c0d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-0.png"}}, "nickname": "m1chaelm", "type": "user", "account_id": "5b2a9176467c9a09caa71ab1"}, "updated_on": null, "type": "issue_comment", "id": 50854171}