{"links": {"self": {"href": "data/repositories/osrf/vrx/issues/64/comments/52579506.json"}, "html": {"href": "#!/osrf/vrx/issues/64#comment-52579506"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/vrx/issues/64.json"}}, "type": "issue", "id": 64, "repository": {"links": {"self": {"href": "data/repositories/osrf/vrx.json"}, "html": {"href": "#!/osrf/vrx"}, "avatar": {"href": "data/bytebucket.org/ravatar/{e278ca38-7edb-4e62-b785-46dff5617d98}ts=2274605"}}, "type": "repository", "name": "vrx", "full_name": "osrf/vrx", "uuid": "{e278ca38-7edb-4e62-b785-46dff5617d98}"}, "title": "Possible frame error in simulated GPS velocity generation"}, "content": {"raw": "To illustrate the issue, I have developed two plugins in a separate branch of my repository \\([https://bitbucket.org/JonathanWheare/vrx/branch/gps\\_plugin](https://bitbucket.org/JonathanWheare/vrx/branch/gps_plugin)\\). These plugins are;\n\n* gazebo\\_v3d, that publishes the world frame velocity as reported by Gazebo.\n* gazebo\\_gps, that publishes the data generated by gazebo\u2019s own GPS sensor\n\nI have modified the GPS configuration of the default wamv by adding both GPS sensors and the velocity plugin. The topics published by the system are;\n\n* gps1/fix and gps1/fix\\_velocity - position and velocity published by the hector gazebo GPS sensor\n* gps2/fix and gps2/fix\\_velocity - position and velocity published by the gazebo internal GPS sensor\n* v3d/vel - velocity published directly from the model\u2019s world frame velocity\n\nTurning on Gazebo\u2019s axes show that the x-axis appears to be pointing towards the east, with the y-axis pointing north. This appears to be correlated with the view of google maps.\n\n![](data/bitbucket.org/repo/BgXLzgM/images/1551995168-Screenshot_from_2019-06-14_18-25-21.png)\nI started off by moving the wamv vehicle north and south of the axes, plotting the latitudes of the two sensors, I got the following graph;\n\n![](data/bitbucket.org/repo/BgXLzgM/images/2318167230-fix_lat.png)\nI then repeated this with longitude;\n\n![](data/bitbucket.org/repo/BgXLzgM/images/3414130841-fix_lon.png)\nFrom this, it appears the hector pluging is producing ENU oriented data, the gazebo GPS sensor appears to be reversed. From this I moved on to testing velocities. To do this, the simulated wamv was driven using the usv\\_keydrive launch file;\n\n![](data/bitbucket.org/repo/BgXLzgM/images/4249077376-vel_x.png)\nthe v3d output should be a ground truth, gps2 the gazebo GPS sensor appears to be generating a negative value. Simultaneously, I was plotting the y values;\n\n![](data/bitbucket.org/repo/BgXLzgM/images/4067654028-vel_y.png)\nThe velocities of GPS sensor 1 seem be swapped, the x axis correlated with the y-axis of the v3d plugin. the y-axis correlates with the reverse of the x-axis of the v3d plugin.\n\nNotes:\n\n* The reference heading of the gazebo world is set to zero degrees, and the frame convention is set to East North Up\n* The gazebo world seems to match the sand island environment using the East - North - Up frame convention\n* The fix position of the hector gazebo sensor appears correct\n* The fix position generated by the built-in GPS sensor appears to be rotated 180 degrees \\(West South Up\\)\n* The hector gazebo sensor appears to have it\u2019s velocities rotated by ninety degrees. This may be caused by the 90 degree reference heading in the sensor plugin\n* The velocities generated by the the gazebo plugin appear to be reversed compared to the v3d plugin, the output of this plugin thus appears to be rotated by 180 degrees\n\nConclusion\n\nThere appears to be an error in frame transformation in both the hector gazebo GPS sensor, and gazebo\u2019s built in GPS sensor. I found this quite surprising, and I would appreciate it if you could check my results.\n\nRegards,\n\nJonathan.", "markup": "markdown", "html": "<p>To illustrate the issue, I have developed two plugins in a separate branch of my repository (<a data-is-external-link=\"true\" href=\"https://bitbucket.org/JonathanWheare/vrx/branch/gps_plugin\" rel=\"nofollow\">https://bitbucket.org/JonathanWheare/vrx/branch/gps_plugin</a>). These plugins are;</p>\n<ul>\n<li>gazebo_v3d, that publishes the world frame velocity as reported by Gazebo.</li>\n<li>gazebo_gps, that publishes the data generated by gazebo\u2019s own GPS sensor</li>\n</ul>\n<p>I have modified the GPS configuration of the default wamv by adding both GPS sensors and the velocity plugin. The topics published by the system are;</p>\n<ul>\n<li>gps1/fix and gps1/fix_velocity - position and velocity published by the hector gazebo GPS sensor</li>\n<li>gps2/fix and gps2/fix_velocity - position and velocity published by the gazebo internal GPS sensor</li>\n<li>v3d/vel - velocity published directly from the model\u2019s world frame velocity</li>\n</ul>\n<p>Turning on Gazebo\u2019s axes show that the x-axis appears to be pointing towards the east, with the y-axis pointing north. This appears to be correlated with the view of google maps.</p>\n<p><img alt=\"\" src=\"data/bitbucket.org/repo/BgXLzgM/images/1551995168-Screenshot_from_2019-06-14_18-25-21.png\" />\nI started off by moving the wamv vehicle north and south of the axes, plotting the latitudes of the two sensors, I got the following graph;</p>\n<p><img alt=\"\" src=\"data/bitbucket.org/repo/BgXLzgM/images/2318167230-fix_lat.png\" />\nI then repeated this with longitude;</p>\n<p><img alt=\"\" src=\"data/bitbucket.org/repo/BgXLzgM/images/3414130841-fix_lon.png\" />\nFrom this, it appears the hector pluging is producing ENU oriented data, the gazebo GPS sensor appears to be reversed. From this I moved on to testing velocities. To do this, the simulated wamv was driven using the usv_keydrive launch file;</p>\n<p><img alt=\"\" src=\"data/bitbucket.org/repo/BgXLzgM/images/4249077376-vel_x.png\" />\nthe v3d output should be a ground truth, gps2 the gazebo GPS sensor appears to be generating a negative value. Simultaneously, I was plotting the y values;</p>\n<p><img alt=\"\" src=\"data/bitbucket.org/repo/BgXLzgM/images/4067654028-vel_y.png\" />\nThe velocities of GPS sensor 1 seem be swapped, the x axis correlated with the y-axis of the v3d plugin. the y-axis correlates with the reverse of the x-axis of the v3d plugin.</p>\n<p>Notes:</p>\n<ul>\n<li>The reference heading of the gazebo world is set to zero degrees, and the frame convention is set to East North Up</li>\n<li>The gazebo world seems to match the sand island environment using the East - North - Up frame convention</li>\n<li>The fix position of the hector gazebo sensor appears correct</li>\n<li>The fix position generated by the built-in GPS sensor appears to be rotated 180 degrees (West South Up)</li>\n<li>The hector gazebo sensor appears to have it\u2019s velocities rotated by ninety degrees. This may be caused by the 90 degree reference heading in the sensor plugin</li>\n<li>The velocities generated by the the gazebo plugin appear to be reversed compared to the v3d plugin, the output of this plugin thus appears to be rotated by 180 degrees</li>\n</ul>\n<p>Conclusion</p>\n<p>There appears to be an error in frame transformation in both the hector gazebo GPS sensor, and gazebo\u2019s built in GPS sensor. I found this quite surprising, and I would appreciate it if you could check my results.</p>\n<p>Regards,</p>\n<p>Jonathan.</p>", "type": "rendered"}, "created_on": "2019-06-14T09:52:50.204899+00:00", "user": {"display_name": "Jonathan Wheare", "uuid": "{65043b9b-c505-4efe-852a-3d2393a0ee80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B65043b9b-c505-4efe-852a-3d2393a0ee80%7D"}, "html": {"href": "https://bitbucket.org/%7B65043b9b-c505-4efe-852a-3d2393a0ee80%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/initials/JW-2.png"}}, "nickname": "Jonathan Wheare", "type": "user", "account_id": "5b9791e8a9fd6d2c834b5864"}, "updated_on": "2019-06-15T00:00:08.328519+00:00", "type": "issue_comment", "id": 52579506}