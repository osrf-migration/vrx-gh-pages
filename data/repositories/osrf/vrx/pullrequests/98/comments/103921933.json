{"links": {"self": {"href": "data/repositories/osrf/vrx/pullrequests/98/comments/103921933.json"}, "html": {"href": "#!/osrf/vrx/pull-requests/98/_/diff#comment-103921933"}}, "parent": {"id": 103885773, "links": {"self": {"href": "data/repositories/osrf/vrx/pullrequests/98/comments/103885773.json"}, "html": {"href": "#!/osrf/vrx/pull-requests/98/_/diff#comment-103885773"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 98, "links": {"self": {"href": "data/repositories/osrf/vrx/pullrequests/98.json"}, "html": {"href": "#!/osrf/vrx/pull-requests/98"}}, "title": "Add 3D Lidar mesh and put it on WAM-V"}, "content": {"raw": "Completed in [96fd3f6](#!/osrf/vrx/commits/96fd3f6c2067117012dc1244052d653fc69162f8).\n\nI tried a many different methods and I found that\n\n`Base Link <= Post (x-side_arm_length, y, platform_z, 0, 0, 0) <= Arm (side_arm_length, 0, 0, 0, 0, 0) <= Lidar (0, 0, z-platform_z, r, p, y)`\n\nended up working best. It required no adjustment links/joints.\n\nMy biggest issues was figuring out how to adjust the `post` and `arm` links individually such that when making joints, they require no adjustments in `rpy` when forming joints. As well, it was important that `rpy` of early joints remained 0 so that no adjustment joints would be necessary to maintain alignment with base frame.\n\n\u200c\n\n**Base<=Post \\(Much more easily read and understood\\)**\n\n```\n    <!-- Base to sensor post joint -->\n    <joint name=\"base_to_${name}_post_joint\" type=\"fixed\">\n      <origin xyz=\"${x-(0.03+0.04)*cos(post_Y)} ${y-(0.03+0.04)*sin(post_Y)} 1.545\" rpy=\"0 0 ${post_Y}\" />\n      <parent link=\"base_link\" />\n      <child link=\"${name}_post_link\" />\n    </joint>\n\n    <!-- Sensor post to sensor post arm joint -->\n    <joint name=\"${name}_post_to_${name}_post_arm_joint\" type=\"fixed\">\n      <origin xyz=\"0.03 0 ${z-1.545-0.05}\" rpy=\"0 0 0\" />\n      <parent link=\"${name}_post_link\" />\n      <child link=\"${name}_post_arm_link\" />\n    </joint>\n\n    <!-- Sensor post arm to lidar joint -->\n    <joint name=\"${name}_post_arm_to_${name}_joint\" type=\"fixed\">\n      <origin xyz=\"0.04 0 0.05\" rpy=\"${R} ${P} ${Y-post_Y}\" />\n      <parent link=\"${name}_post_arm_link\" />\n      <child link=\"${name}_link\" />\n    </joint>\n```\n\n**Base<=Lidar \\(harder to read and understand the 1st joint has nonzero rpy, so that angle propogates. This requires an adjustment link to maintain alignment with base frame. If there was no adjustment joint, then the xyz of sensor\\_post will be much more complicated\\)**\n\n```\n    <!-- Base to lidar joint -->\n    <joint name=\"base_to_${name}_joint\" type=\"fixed\">\n      <origin xyz=\"${x} ${y} ${z}\" rpy=\"${R} ${P} ${Y}\" />\n      <parent link=\"base_link\" />\n      <child link=\"${name}_link\" />\n    </joint>\n\n    <!-- Adjustment joint -->\n    <link name=\"adjustment_link\"/>\n    <joint name=\"adjustment_joint\" type=\"fixed\">\n      <origin xyz=\"0 0 0\" rpy=\"${-R} ${-P} ${-Y}\" />\n      <parent link=\"${name}_link\" />\n      <child link=\"adjustment_link\" />\n    </joint>\n\n    <!-- Lidar to sensor post arm joint -->\n    <joint name=\"${name}_to_${name}_post_arm_joint\" type=\"fixed\">\n      <origin xyz=\"${-0.04*cos(post_Y)} ${-0.04*sin(post_Y)} -0.05\" rpy=\"0 0 ${post_Y}\" />\n      <parent link=\"adjustment_link\" />\n      <child link=\"${name}_post_arm_link\" />\n    </joint>\n\n    <!-- Adjustment joint -->\n    <link name=\"adjustment_2_link\"/>\n    <joint name=\"adjustment_2_joint\" type=\"fixed\">\n      <origin xyz=\"0 0 0\" rpy=\"0 0 ${-post_Y}\" />\n      <parent link=\"${name}_post_arm_link\" />\n      <child link=\"adjustment_2_link\" />\n    </joint>\n    \n    <!-- Sensor post arm to sensor post joint -->\n    <joint name=\"${name}_post_arm_to_${name}_post_joint\" type=\"fixed\">\n      <origin xyz=\"${-0.03*cos(post_Y)} ${-0.03*sin(post_Y)} ${1.545+0.05-z}\" rpy=\"0 0 0\" />\n      <parent link=\"adjustment_2_link\" />\n      <child link=\"${name}_post_link\" />\n    </joint>\n```", "markup": "markdown", "html": "<p>Completed in <a data-is-external-link=\"true\" href=\"#!/osrf/vrx/commits/96fd3f6c2067117012dc1244052d653fc69162f8\" rel=\"nofollow\">96fd3f6</a>.</p>\n<p>I tried a many different methods and I found that</p>\n<p><code>Base Link &lt;= Post (x-side_arm_length, y, platform_z, 0, 0, 0) &lt;= Arm (side_arm_length, 0, 0, 0, 0, 0) &lt;= Lidar (0, 0, z-platform_z, r, p, y)</code></p>\n<p>ended up working best. It required no adjustment links/joints.</p>\n<p>My biggest issues was figuring out how to adjust the <code>post</code> and <code>arm</code> links individually such that when making joints, they require no adjustments in <code>rpy</code> when forming joints. As well, it was important that <code>rpy</code> of early joints remained 0 so that no adjustment joints would be necessary to maintain alignment with base frame.</p>\n<p>\u200c</p>\n<p><strong>Base&lt;=Post (Much more easily read and understood)</strong></p>\n<div class=\"codehilite\"><pre><span></span>    <span class=\"c\">&lt;!-- Base to sensor post joint --&gt;</span>\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;base_to_</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">x</span><span class=\"o\">-</span><span class=\"p\">(</span><span class=\"mf\">0.03</span><span class=\"o\">+</span><span class=\"mf\">0.04</span><span class=\"p\">)</span><span class=\"o\">*</span><span class=\"n\">cos</span><span class=\"p\">(</span><span class=\"n\">post_Y</span><span class=\"p\">)</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"n\">y</span><span class=\"o\">-</span><span class=\"p\">(</span><span class=\"mf\">0.03</span><span class=\"o\">+</span><span class=\"mf\">0.04</span><span class=\"p\">)</span><span class=\"o\">*</span><span class=\"n\">sin</span><span class=\"p\">(</span><span class=\"n\">post_Y</span><span class=\"p\">)</span><span class=\"cp\">}</span><span class=\"s\"> 1.545&quot;</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;0 0 </span><span class=\"cp\">${</span><span class=\"n\">post_Y</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;base_link&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_link&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n\n    <span class=\"c\">&lt;!-- Sensor post to sensor post arm joint --&gt;</span>\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_to_</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_arm_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;0.03 0 </span><span class=\"cp\">${</span><span class=\"n\">z</span><span class=\"o\">-</span><span class=\"mf\">1.545</span><span class=\"o\">-</span><span class=\"mf\">0.05</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;0 0 0&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_link&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_arm_link&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n\n    <span class=\"c\">&lt;!-- Sensor post arm to lidar joint --&gt;</span>\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_arm_to_</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;0.04 0 0.05&quot;</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">R</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"n\">P</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"n\">Y</span><span class=\"o\">-</span><span class=\"n\">post_Y</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_arm_link&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_link&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n</pre></div>\n\n\n<p><strong>Base&lt;=Lidar (harder to read and understand the 1st joint has nonzero rpy, so that angle propogates. This requires an adjustment link to maintain alignment with base frame. If there was no adjustment joint, then the xyz of sensor_post will be much more complicated)</strong></p>\n<div class=\"codehilite\"><pre><span></span>    <span class=\"c\">&lt;!-- Base to lidar joint --&gt;</span>\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;base_to_</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">x</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"n\">y</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"n\">z</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">R</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"n\">P</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"n\">Y</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;base_link&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_link&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n\n    <span class=\"c\">&lt;!-- Adjustment joint --&gt;</span>\n    <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;adjustment_link&quot;/</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;adjustment_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;0 0 0&quot;</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"o\">-</span><span class=\"n\">R</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"o\">-</span><span class=\"n\">P</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"o\">-</span><span class=\"n\">Y</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_link&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;adjustment_link&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n\n    <span class=\"c\">&lt;!-- Lidar to sensor post arm joint --&gt;</span>\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_to_</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_arm_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"o\">-</span><span class=\"mf\">0.04</span><span class=\"o\">*</span><span class=\"n\">cos</span><span class=\"p\">(</span><span class=\"n\">post_Y</span><span class=\"p\">)</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"o\">-</span><span class=\"mf\">0.04</span><span class=\"o\">*</span><span class=\"n\">sin</span><span class=\"p\">(</span><span class=\"n\">post_Y</span><span class=\"p\">)</span><span class=\"cp\">}</span><span class=\"s\"> -0.05&quot;</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;0 0 </span><span class=\"cp\">${</span><span class=\"n\">post_Y</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;adjustment_link&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_arm_link&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n\n    <span class=\"c\">&lt;!-- Adjustment joint --&gt;</span>\n    <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;adjustment_2_link&quot;/</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;adjustment_2_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;0 0 0&quot;</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;0 0 </span><span class=\"cp\">${</span><span class=\"o\">-</span><span class=\"n\">post_Y</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_arm_link&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;adjustment_2_link&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n\n    <span class=\"c\">&lt;!-- Sensor post arm to sensor post joint --&gt;</span>\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_arm_to_</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;origin</span> <span class=\"na\">xyz=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"o\">*</span><span class=\"n\">cos</span><span class=\"p\">(</span><span class=\"n\">post_Y</span><span class=\"p\">)</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"o\">*</span><span class=\"n\">sin</span><span class=\"p\">(</span><span class=\"n\">post_Y</span><span class=\"p\">)</span><span class=\"cp\">}</span><span class=\"s\"> </span><span class=\"cp\">${</span><span class=\"mf\">1.545</span><span class=\"o\">+</span><span class=\"mf\">0.05</span><span class=\"o\">-</span><span class=\"n\">z</span><span class=\"cp\">}</span><span class=\"s\">&quot;</span> <span class=\"na\">rpy=</span><span class=\"s\">&quot;0 0 0&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;parent</span> <span class=\"na\">link=</span><span class=\"s\">&quot;adjustment_2_link&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;child</span> <span class=\"na\">link=</span><span class=\"s\">&quot;</span><span class=\"cp\">${</span><span class=\"n\">name</span><span class=\"cp\">}</span><span class=\"s\">_post_link&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n</pre></div>", "type": "rendered"}, "created_on": "2019-05-30T08:12:26.701314+00:00", "user": {"display_name": "Tyler Lum", "uuid": "{305d9368-23ba-4f72-b1d4-7d17d2a062d8}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B305d9368-23ba-4f72-b1d4-7d17d2a062d8%7D"}, "html": {"href": "https://bitbucket.org/%7B305d9368-23ba-4f72-b1d4-7d17d2a062d8%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/5b96b66385af94340e7cabce/b8bb780f-62b7-47f8-9d03-ee65c7d17ad4/128"}}, "nickname": "tylerlum", "type": "user", "account_id": "5b96b66385af94340e7cabce"}, "updated_on": "2019-05-30T08:18:28.706453+00:00", "type": "pullrequest_comment", "id": 103921933}